
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Dashboard</title>
    <link rel="stylesheet" href="./assets/style.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  </head>
  <body>
    <!-- Navbar displaying the time and weather dashboard -->
    <nav class="navbar">

      <!-- Weather Dashboard -->
      <h1 class="text-light w-100 text-center">Weather Dashboard</h1>

      <!-- Display for current day and time -->
      <body onload=display_ct();>

      <!-- Current Day and Time -->
      <span class="text-center text-light w-100" id='ct' ></span>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Main Row -->
        <div class="row">
            <div class="col-sm-12">
                <div>
                    <h2 class="mt-2">Search for a City:</h2>
                </div> 
                <div class="col-8 card float-right">
                    <div id="cityList" class="is-hidden" for="city-input">
                        <h2 class="text-center">City Name:</h2>
                    </div>
                </div>
                <div class="form-errors"></div>

                <div class="input-group w-25">
                    <input id="city" type="text" placeholder="Enter a City Name" class="form-control">
                    <button class="btn btn-primary" id="search">
                        <i class="fas fa-search"></i>
                    </button>

                </div>
                
                <h3 class="mt-2">Recent cities:</h3>
                <ul id="searchHistory" class='list-group w-25'></ul>
            </div>

        <aside class="row">

        <div id="forecast-weather" class="mt-2 float-right col-md-12-sm">

              <h4 class="text-center">5-Day Forecast:</h4>

              <!-- First Day Forecast -->
              <div id="forecast-cards">
                  <div class="card forecast">
                      <div id="forecast1" class="card-body">

                          <!-- Displays the day of Forecast -->
                          <span class="card-title" id='forecast-date1'>
                          </span>

                          <!-- Displays the current Forecast -->
                          <span id='forecast-icon1'></span>

                          <!-- Displays the Forecast Temperature -->
                          <p class="card-text" id="forecast-temp1"></p>

                          <!-- Displays the Forecast Humidity -->
                          <p class="card-text" id="forecast-humidity1"></p>
                      </div>
                  </div>

                  <!-- Second Day Forecast -->
                  <div class="card forecast">
                      <div id="forecast2" class="card-body">

                          <!-- Displays the day of Forecast -->
                          <span class="card-title" id='forecast-date2'>
                          </span>

                          <!-- Displays the current Forecast -->
                          <span id='forecast-icon2'></span>

                          <!-- Displays the Forecast Temperature -->
                          <p class="card-text" id="forecast-temp2"></p>

                          <!-- Displays the Forecast Humidity -->
                          <p class="card-text" id="forecast-humidity2"></p>
                      </div>
                  </div>

                  <!-- Third Day Forecast -->
                  <div class="card forecast">
                      <div id="forecast3" class="card-body">

                        <!-- Displays the day of Forecast -->
                        <span class="card-title" id='forecast-date3'>
                        </span>

                        <!-- Displays the current Forecast -->
                        <span id='forecast-icon3'></span>

                        <!-- Displays the Forecast Temperature -->
                        <p class="card-text" id="forecast-temp3"></p>

                        <!-- Displays the Forecast Humidity -->
                        <p class="card-text" id="forecast-humidity3"></p>
                      </div>
                  </div>

                  <!-- Fourth Day Forecast -->
                  <div class="card forecast">
                      <div id="forecast4" class="card-body">

                        <!-- Displays the day of Forecast -->
                        <span class="card-title" id='forecast-date4'>
                        </span>

                        <!-- Displays the current Forecast -->
                        <span id='forecast-icon4'></span>

                        <!-- Displays the Forecast Temperature -->
                        <p class="card-text" id="forecast-temp4"></p>

                        <!-- Displays the Forecast Humidity -->
                        <p class="card-text" id="forecast-humidity4"></p>
                      </div>
                  </div>

                  <!-- Fifth Day Forecast -->
                  <div class="card forecast">
                      <div id="forecast5" class="card-body">

                        <!-- Displays the day of Forecast -->
                        <span class="card-title" id='forecast-date5'>
                        </span>

                        <!-- Displays the current Forecast -->
                        <span id='forecast-icon5'></span>

                        <!-- Displays the Forecast Temperature -->
                        <p class="card-text" id="forecast-temp5"></p>

                        <!-- Displays the Forecast Humidity -->
                        <p class="card-text" id="forecast-humidity5"></p>
                      </div>
                  </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-text text-center">Copyright &copy; 2020 - <a href="https://github.com/tonycrosby-tech">Tony Crosby</a></div>
    </footer>

    <script>
                // display time
        function display_c() {
        var refresh = 1000; // Refresh rate in milli seconds
        mytime = setTimeout("display_ct()", refresh);
        }

        // function to create the time
        function display_ct() {
        var x = new Date();
        document.getElementById("ct").innerHTML = x;
        display_c();
        }

        var API_KEY = "f5e25466bfa1e46ad656169c960527a3";

        var searchBtn = $("#search");
        var cityInput = $("#city");
        var searchHistoryDiv = $("#searchHistory");
        var searchArray = [];
        var searchCity = cityInput.val();
        var searchStorage = JSON.parse(localStorage.getItem("search"));

        appendStorage();

        // This function appends the stored search history items to the searchHistory div
        function appendStorage() {
        if (searchStorage === null) {
            searchArray = [];
        } else {
            for (var i = 0; i < searchStorage.length; i++) {
            var storedHistoryItem = $("<li>");
            storedHistoryItem.text(searchStorage[i]);
            storedHistoryItem.attr("class", "list-group-item");
            searchHistoryDiv.append(storedHistoryItem);
            searchArray = searchStorage;
            }
        }
        }

        function createSearchHistory() {
        if (searchCity !== "") {
            var searchHistoryItem = $("<li>");
            searchHistoryItem.text(searchCity);
            searchHistoryItem.attr("class", "list-group-item");
            searchHistoryDiv.append(searchHistoryItem);
            searchArray.push(searchCity);
            localStorage.setItem("search", JSON.stringify(searchArray));
            cityInput.val("");
        }
        }

        searchBtn.on("click", function (event) {
        event.preventDefault();
        searchCity = cityInput.val();
        renderWeather();
        createSearchHistory();
        });

        searchHistoryDiv.on("click", ".list-group-item", function (event) {
        searchCity = event.target.textContent;
        renderWeather();
        });

        function renderWeather() {
        var queryURL =
            "https://api.openweathermap.org/data/2.5/weather?q=" +
            searchCity +
            "&appid=" +
            API_KEY;

        $(".form-errors").text("Please enter an actual City").hide();
        $.ajax({
            url: queryURL,
            method: "GET",
            error: (err) => {
            //If API throws error then say
            $(".form-errors").text("Please enter an actual City").show();
            return;
            },
        }).then(function (response) {
            var cityNameInput = $("<h2 class='text-center'>").text(response.name);

            // function createCityList() {
            //   var cityNameList = $(`<button class='history'>${city}</button>`).text(
            //     response.name
            //   );

            //   var cities = $("#search-input").val();

            //   if (localStorage.getItem("city") === null) {

            //   } else {

            //   }

            //   console.log(cities);

            //   cityNameList.addClass("list-group-item-action");

            //   $("#searchHistory").append(cityNameList);
            // }
            // createCityList();

            var weatherIcon = $("<img>").attr(
            "src",
            "https://openweathermap.org/img/wn/" + response.weather[0].icon + ".png"
            );

            var weatherType = $("<p>").text(response.weather[0].main);

            var tempInt = parseInt(response.main.temp);

            var tempF = (tempInt * 9) / 5 - 459.67;

            var cityTemp = $("<p>").text(
            "Current Temperature: " + Math.floor(tempF) + " °F"
            );

            var cityHumidity = $("<p>").text(
            "Humidity: " + response.main.humidity + "%"
            );

            var cityWindSpeed = $("<p>").text(
            "Wind Speed: " + Math.round(response.wind.speed) + " MPH"
            );

            $("#cityList").empty();

            $("#cityList").append(
            cityNameInput,
            weatherIcon,
            weatherType,
            cityTemp,
            cityHumidity,
            cityWindSpeed
            );

            // latitude uvi position
            var latitude = response.coord.lat;

            // longitude uvi position
            var longitude = response.coord.lon;

            // uvi queryURL to display uvi data
            var queryURLuvi =
            "https://api.openweathermap.org/data/2.5/uvi/forecast?&units=imperial&appid=f5e25466bfa1e46ad656169c960527a3&q=" +
            "&lat=" +
            latitude +
            "&lon=" +
            longitude;

            // ajax call for UVI
            $.ajax({
            url: queryURLuvi,
            method: "GET",
            }).then(function (response) {
            // gets the UVI
            var uvIndex = response[0].value;

            // empty color display
            var uvColor = "";

            // if its less then three then highlight green
            if (uvIndex < 3) {
                uvColor = "green";

                // if its less then 6 then highlight yellow
            } else if (uvIndex < 6) {
                uvColor = "yellow";

                // if its less then 8 then highlight orange
            } else if (uvIndex < 8) {
                uvColor = "orange";

                // if its less then 11 then highlight red
            } else if (uvIndex < 11) {
                uvColor = "red";

                // if its anything else then highlight violet
            } else {
                uvColor = "violet";
            }

            // gets the UV Index
            var cityUVIndex = $(
                "<span class='border d-inline-block rounded px-2 py-1 mb-4'>"
            ).text("UV Index: " + uvIndex);
            // highlights the appropiate color
            $(cityUVIndex).attr("style", "background-color: " + uvColor);

            // displays in the city box
            $("#cityList").append(cityUVIndex);


            // 5 day forecast
            var queryURLforecast =
                "https://api.openweathermap.org/data/2.5/forecast?&units=imperial&appid=f5e25466bfa1e46ad656169c960527a3&q=" +
                searchCity;

            // ajax call to get 5 day forecast at 3pm everyday
            $.ajax({
                url: queryURLforecast,
                method: "GET",
                // Store all of the data inside of an object called forecast
            }).then(function (forecast) {
                // log forecast in the console
                console.log(forecast);

                // gets the day of the forecast
                var nowMoment = moment();

                // Loop through the forecast array and display a single forecast for 5 days
                for (var i = 6; i < forecast.list.length; i += 8) {
                // creating an h5 to put the date in
                var forecastDate = $("<h5>");

                // this is the day in the array
                var forecastDay = (i + 2) / 8;

                // empty the box that displays the forecast
                $("#forecast-date" + forecastDay).empty();

                // displays the date and add 1 day to display 5 days
                $("#forecast-date" + forecastDay).append(
                    forecastDate.text(nowMoment.add(1, "days").format("dddd, M/D/YY"))
                );

                // create an img for the forecast
                var forecastIcon = $("<img>");

                // gets the icon from the DOM
                forecastIcon.attr(
                    "src",
                    "https://openweathermap.org/img/w/" +
                    forecast.list[i].weather[0].icon +
                    ".png"
                );

                // empty the current icon
                $("#forecast-icon" + forecastDay).empty();

                // gets the new icon then displays it
                $("#forecast-icon" + forecastDay).append(forecastIcon);

                // gets the temperature and displays it
                $("#forecast-temp" + forecastDay).text(
                    "Temp: " + Math.round(forecast.list[i].main.temp) + " °F"
                );

                // gets the humidity and displays it
                $("#forecast-humidity" + forecastDay).text(
                    "Humidity: " + forecast.list[i].main.humidity + "%"
                );
                }
            })
            })
        })
        }
    </script>

    </body>
</html>